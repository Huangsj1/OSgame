---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠==


# Text Elements
TaskManager ^xJqB2fEh

num_app ^QLBvFyER

TaskManagerInner ^TY08lUFS

TaskManagerInner ^pB2uOvnT

有一个static TASKMANAGER，
会在开始时初始化 ^8a4aOlNG

current_task ^wIa6rpZs

               tasks
[TaskControlBlock; MAX_APP_NUM] ^shJwJH5t

TaskControlBlock ^caRHNU4s

ra: __restore() ^lxANo6u4

sp = &KernelStack[app_id] ^32gpbYNv

      s: [0; 12]
(12个需要保存的寄存器) ^hYJRXhUR

KernelStack ^L0RwsHfO

0x0 ^laFm0HrD

0x8192 ^Awm6IIxi

TaskContext ^srEjG3Ov

tasks_tatus
  (READY) ^oeAEof1t

TrapContext ^th9t62zV

sepc: app_base_address ^VvxELWDk

sstatus ^NCfjifN0

        s: [0; 32]
(32个User Mode下的寄存器)
(sp = &UserStack[app_id]） ^WnQ8oXYm

从User Mode回到Kernel Mode后，
    内核sp用的都是这个栈 ^KVVNMG8g

初始时所有的TCB的内容都一样 ^LxP9apy3

初始时所有的KernelStack的内容也都一样 ^VMVfCLli

run_first_task(): 
用一个临时变量TaskContext作为current，tasks[0].TaskContext作为next调用__switch() ^DCGxExlD

__switch(current_task_cx, next_task_cx): 
保存当前内容到current，加载next的内容到寄存器中（sp=KernelStack; ra=__restore）
之后ret返回到__restore()中 ^ydECjwzP

__restore():
(进入之前sp=KernelStack)
将KernelStack中TrapContext的sstatus、sepc、sp(UserStack)的内容分别存到寄存器sstatus、sepc、sscratch中
之后取出其他寄存器内容到对应的寄存器中
然后交换sscratch和sp寄存器内容（交换后sscratch=KernelStack, sp=UserStack）
最后iret返回用户空间（sepc=app_base_address） ^CWmDXL0I

用户下：sys_yield() -> syscall() -> 内核下：syscall() -> sys_yield() -> suspend_current_and_run_next()
(sys_exit() 和 sys_yield()类似)
之后会调用mark_current_suspend()（标记当前task的status为‘Ready'）和run_next_task()（调用下一个app） ^5FZI9ARd

run_next_task():
标记下一个tasks[next].task_status = 'Running'
对当前task和找到的下一个task（若无则下一个就是当前的task）调用__switch() ^vY17chNV

__switch(current_task_cx, next_task_cx):
保存当前内容到current，加载next的内容到寄存器
将当前ra(ra=调用__switch函数的位置) 和sp(sp=当前栈顶的位置) 保存到current_task_cx中
加载next_task_cx内容到当前寄存器中
(若next为第一次调用：ra=__restore, sp=KernelStack；否则: ra=next上次调用__switch的位置, sp=KernelStack用到的位置) ^jYnTPPES

栈顶 ^HrHC9K3F

KernelStack ^BWWFf4W2

0x0 ^PVHiugOh

0x8192 ^VApfGglK

TrapContext ^SFcSFS8m

sepc: User的返回地址 ^uOFymknO

sstatus ^pvza9kpE

        s: [xxx; 32]
(32个User Mode下的寄存器)
(sp = User的sp栈顶） ^X86Jv3AU

从User Mode回到Kernel Mode后，
    内核sp用的都是这个栈 ^EbtYCaJd

系统调用后的KernelStack ^RYsJFhiP

ecall进入Trap.S中的__alltarps()中保存上下文 ^aEgC2YFd

回到了next上次调用__switch的位置，之后不断返回，最后返回到最开始调用__alltraps()的call trap_handler位置（这时sp也回到KernelStack的TraoContext位置）
__alltraps()结束后面紧跟着的就是__restore()：从TraoContext恢复上下文，iret从Kernel返回到User ^GTPcTtXY

%%
# Drawing
```json
{
	"type": "excalidraw",
	"version": 2,
	"source": "https://github.com/zsviczian/obsidian-excalidraw-plugin/releases/tag/1.8.18",
	"elements": [
		{
			"id": "1HSr95IB2W80AJ2imuyD3",
			"type": "rectangle",
			"x": -423.7917938232422,
			"y": -245.65354919433594,
			"width": 173.62802124023438,
			"height": 117.21261596679688,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 1363751972,
			"version": 200,
			"versionNonce": 1220583076,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false
		},
		{
			"id": "xJqB2fEh",
			"type": "text",
			"x": -409.55101013183594,
			"y": -277.9691925048828,
			"width": 130.91990661621094,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 936238236,
			"version": 59,
			"versionNonce": 404295068,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "TaskManager",
			"rawText": "TaskManager",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "TaskManager"
		},
		{
			"id": "upHvQecfE-Z-s36oNg9YB",
			"type": "line",
			"x": -423.7917938232422,
			"y": -187.59495544433594,
			"width": 172.53262329101562,
			"height": 0.547698974609375,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1799920284,
			"version": 97,
			"versionNonce": 1543318052,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					172.53262329101562,
					0.547698974609375
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": null
		},
		{
			"id": "QLBvFyER",
			"type": "text",
			"x": -380.52174377441406,
			"y": -229.22190856933594,
			"width": 82.93992614746094,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1386908,
			"version": 31,
			"versionNonce": 1297938972,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "num_app",
			"rawText": "num_app",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "num_app"
		},
		{
			"id": "TY08lUFS",
			"type": "text",
			"x": -416.67140197753906,
			"y": -170.06785583496094,
			"width": 163.6045756092644,
			"height": 21.809112548828132,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 189176868,
			"version": 69,
			"versionNonce": 2124170660,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "gkQolGdDjhliQ5crdJCi5",
					"type": "arrow"
				}
			],
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "TaskManagerInner",
			"rawText": "TaskManagerInner",
			"fontSize": 18.174260457356763,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "TaskManagerInner"
		},
		{
			"id": "8vqofTB9CL4dR5cmK8zwn",
			"type": "rectangle",
			"x": -181.74073791503906,
			"y": -273.58741760253906,
			"width": 323.70404052734375,
			"height": 171.43716430664062,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 1103916572,
			"version": 143,
			"versionNonce": 2087671452,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "gkQolGdDjhliQ5crdJCi5",
					"type": "arrow"
				}
			],
			"updated": 1681055164168,
			"link": null,
			"locked": false
		},
		{
			"id": "pB2uOvnT",
			"type": "text",
			"x": -117.68647766113281,
			"y": -302.61671447753906,
			"width": 180.0398712158203,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1940296988,
			"version": 75,
			"versionNonce": 1170993444,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "TaskManagerInner",
			"rawText": "TaskManagerInner",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "TaskManagerInner"
		},
		{
			"id": "8a4aOlNG",
			"type": "text",
			"x": -451.2202911376953,
			"y": -121.32051086425781,
			"width": 235.1044158935547,
			"height": 36.04849796309348,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1767987228,
			"version": 158,
			"versionNonce": 1107436316,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "有一个static TASKMANAGER，\n会在开始时初始化",
			"rawText": "有一个static TASKMANAGER，\n会在开始时初始化",
			"fontSize": 15.567318276743137,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "有一个static TASKMANAGER，\n会在开始时初始化"
		},
		{
			"id": "Taf5rEaCx0VWYNDpRcUIp",
			"type": "line",
			"x": -180.6453399658203,
			"y": -149.80210876464844,
			"width": 313.8450927734375,
			"height": 2.190887451171875,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1685139100,
			"version": 116,
			"versionNonce": 1895443620,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					313.8450927734375,
					2.190887451171875
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": null
		},
		{
			"id": "wIa6rpZs",
			"type": "text",
			"x": -84.79383850097656,
			"y": -138.8477020263672,
			"width": 131.93988037109375,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1279749028,
			"version": 123,
			"versionNonce": 1418157980,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "current_task",
			"rawText": "current_task",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "current_task"
		},
		{
			"id": "shJwJH5t",
			"type": "text",
			"x": -172.9772491455078,
			"y": -228.67417907714844,
			"width": 307.6597900390625,
			"height": 40.8,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 325633828,
			"version": 184,
			"versionNonce": 567605284,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "2PEZr-SezVBlVAZzSF_gV",
					"type": "arrow"
				}
			],
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "               tasks\n[TaskControlBlock; MAX_APP_NUM]",
			"rawText": "               tasks\n[TaskControlBlock; MAX_APP_NUM]",
			"fontSize": 17.065247301709622,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "               tasks\n[TaskControlBlock; MAX_APP_NUM]"
		},
		{
			"id": "gkQolGdDjhliQ5crdJCi5",
			"type": "arrow",
			"x": -251.84925842285156,
			"y": -170.06785583496094,
			"width": 69.560791015625,
			"height": 78.32431030273438,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 454672924,
			"version": 147,
			"versionNonce": 1278282780,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					69.560791015625,
					-78.32431030273438
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "TY08lUFS",
				"focus": 0.8015956035054032,
				"gap": 1.2175679454230846
			},
			"endBinding": {
				"elementId": "8vqofTB9CL4dR5cmK8zwn",
				"focus": 0.9082758715191136,
				"gap": 1
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "e9eZvIrkYGqlTRbHVxjmv",
			"type": "rectangle",
			"x": 227.40794372558594,
			"y": -330.5505676269531,
			"width": 232.23437499999997,
			"height": 319.86997985839844,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 371814812,
			"version": 295,
			"versionNonce": 340415396,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "2PEZr-SezVBlVAZzSF_gV",
					"type": "arrow"
				}
			],
			"updated": 1681055164168,
			"link": null,
			"locked": false
		},
		{
			"id": "caRHNU4s",
			"type": "text",
			"x": 248.22142028808594,
			"y": -357.9366912841797,
			"width": 170.2198486328125,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 369421348,
			"version": 83,
			"versionNonce": 1794189468,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "TaskControlBlock",
			"rawText": "TaskControlBlock",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "TaskControlBlock"
		},
		{
			"id": "qhFEqEFdYDb6rwsUMQnNm",
			"type": "line",
			"x": 230.14659118652344,
			"y": -145.1545867919922,
			"width": 220.732177734375,
			"height": 0.547698974609375,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1603960484,
			"version": 242,
			"versionNonce": 1451769636,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					220.732177734375,
					0.547698974609375
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": null
		},
		{
			"id": "dd8ikMqhGzmNwOYfS869w",
			"type": "line",
			"x": 229.59886169433594,
			"y": -194.4496307373047,
			"width": 219.089111328125,
			"height": 3.83404541015625,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1835701668,
			"version": 254,
			"versionNonce": 1685697820,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					219.089111328125,
					3.83404541015625
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": null
		},
		{
			"id": "lxANo6u4",
			"type": "text",
			"x": 252.05552673339844,
			"y": -129.2706756591797,
			"width": 157.19985961914062,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1860506532,
			"version": 186,
			"versionNonce": 16562852,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164168,
			"link": null,
			"locked": false,
			"text": "ra: __restore()",
			"rawText": "ra: __restore()",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "ra: __restore()"
		},
		{
			"id": "32gpbYNv",
			"type": "text",
			"x": 235.62376403808594,
			"y": -176.92250061035156,
			"width": 212.49797799314084,
			"height": 17.895458984375022,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1688681756,
			"version": 475,
			"versionNonce": 641511836,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "LnNTnhH3Ri_Y7h7iLr-2l",
					"type": "arrow"
				},
				{
					"id": "BQI4pF6lTWmGK2HUkEiQt",
					"type": "arrow"
				}
			],
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "sp = &KernelStack[app_id]",
			"rawText": "sp = &KernelStack[app_id]",
			"fontSize": 15.95592909699515,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "sp = &KernelStack[app_id]"
		},
		{
			"id": "hYJRXhUR",
			"type": "text",
			"x": 232.8852996826172,
			"y": -246.83251953125,
			"width": 214.719970703125,
			"height": 48,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 728915876,
			"version": 258,
			"versionNonce": 1851115044,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "      s: [0; 12]\n(12个需要保存的寄存器)",
			"rawText": "      s: [0; 12]\n(12个需要保存的寄存器)",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "      s: [0; 12]\n(12个需要保存的寄存器)"
		},
		{
			"id": "2PEZr-SezVBlVAZzSF_gV",
			"type": "arrow",
			"x": 138.1291961669922,
			"y": -195.16362257610302,
			"width": 88.18341064453125,
			"height": 114.48129476293269,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 269817500,
			"version": 324,
			"versionNonce": 527179292,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					88.18341064453125,
					-114.48129476293269
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "shJwJH5t",
				"gap": 3.4466552734375,
				"focus": 0.9872153368407804
			},
			"endBinding": {
				"elementId": "e9eZvIrkYGqlTRbHVxjmv",
				"gap": 1.0953369140625,
				"focus": 0.9372317885971647
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "ZPrKMx0TkfyabS6nP0Bet",
			"type": "rectangle",
			"x": 574.1985931396484,
			"y": -333.46266174316406,
			"width": 213.0640869140625,
			"height": 318.226806640625,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 2110076828,
			"version": 174,
			"versionNonce": 1937858980,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "LnNTnhH3Ri_Y7h7iLr-2l",
					"type": "arrow"
				}
			],
			"updated": 1681055164169,
			"link": null,
			"locked": false
		},
		{
			"id": "L0RwsHfO",
			"type": "text",
			"x": 620.2072601318359,
			"y": -363.03968811035156,
			"width": 113.91990661621094,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 932837148,
			"version": 121,
			"versionNonce": 150600348,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "KernelStack",
			"rawText": "KernelStack",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "KernelStack"
		},
		{
			"id": "laFm0HrD",
			"type": "text",
			"x": 794.5284271240234,
			"y": -38.86274719238281,
			"width": 38.759979248046875,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 607738524,
			"version": 24,
			"versionNonce": 397249828,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "0x0",
			"rawText": "0x0",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "0x0"
		},
		{
			"id": "Awm6IIxi",
			"type": "text",
			"x": 790.1467132568359,
			"y": -348.87376403808594,
			"width": 72.13995361328125,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 812503196,
			"version": 42,
			"versionNonce": 764954396,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "0x8192",
			"rawText": "0x8192",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "0x8192"
		},
		{
			"id": "_jQNPm3XODlN5xVTKEG96",
			"type": "rectangle",
			"x": 230.84812927246094,
			"y": -327.77394104003906,
			"width": 225.1139526367188,
			"height": 227.30484008789062,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 1211713956,
			"version": 239,
			"versionNonce": 1279805604,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false
		},
		{
			"id": "srEjG3Ov",
			"type": "text",
			"x": 275.4045867919922,
			"y": -305.60365295410156,
			"width": 128.09988403320312,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 515391516,
			"version": 17,
			"versionNonce": 834208668,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "TaskContext",
			"rawText": "TaskContext",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "TaskContext"
		},
		{
			"id": "0tSAof9SovsHqeA1WfZUV",
			"type": "rectangle",
			"x": 271.2136688232422,
			"y": -309.43772888183594,
			"width": 137.4783935546875,
			"height": 33.95880126953125,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 1795511460,
			"version": 61,
			"versionNonce": 620729380,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false
		},
		{
			"id": "oeAEof1t",
			"type": "text",
			"x": 281.97727966308594,
			"y": -70.84660339355469,
			"width": 130.77987670898438,
			"height": 48,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1514121244,
			"version": 84,
			"versionNonce": 1536045084,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "tasks_tatus\n  (READY)",
			"rawText": "tasks_tatus\n  (READY)",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "tasks_tatus\n  (READY)"
		},
		{
			"id": "LnNTnhH3Ri_Y7h7iLr-2l",
			"type": "arrow",
			"x": 443.43483547220615,
			"y": -157.89127700384273,
			"width": 129.65176634445868,
			"height": 13.840506074397013,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 187349788,
			"version": 615,
			"versionNonce": 264335268,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					129.65176634445868,
					13.840506074397013
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "32gpbYNv",
				"focus": -0.037378059338799105,
				"gap": 1.13576462213382
			},
			"endBinding": {
				"elementId": "VvxELWDk",
				"focus": -1.0472406771778295,
				"gap": 14.145621694077363
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "HWJHd0OCjSgjFvfPgeDlC",
			"type": "rectangle",
			"x": 577.2353973388672,
			"y": -330.1351318359375,
			"width": 207.58685302734375,
			"height": 198.27558898925778,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 254406948,
			"version": 299,
			"versionNonce": 1527368860,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "LnNTnhH3Ri_Y7h7iLr-2l",
					"type": "arrow"
				},
				{
					"id": "-NLj8SGFJ0t8N3TAgCB-u",
					"type": "arrow"
				}
			],
			"updated": 1681055164169,
			"link": null,
			"locked": false
		},
		{
			"id": "-TfkzC9D3-q_4GZ8fZdSU",
			"type": "rectangle",
			"x": 611.8373870849609,
			"y": -319.18067932128906,
			"width": 139.12152099609375,
			"height": 32.31561279296875,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 1829029668,
			"version": 59,
			"versionNonce": 213637924,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false
		},
		{
			"id": "th9t62zV",
			"type": "text",
			"x": 620.3395843505859,
			"y": -315.9897918701172,
			"width": 125.95988464355469,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1633303972,
			"version": 21,
			"versionNonce": 299751708,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "TrapContext",
			"rawText": "TrapContext",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "TrapContext"
		},
		{
			"id": "XV_SKoBVlkFZAmN1qNCpv",
			"type": "line",
			"x": 577.3731536865234,
			"y": -200.8726043701172,
			"width": 202.109619140625,
			"height": 1.643157958984375,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1272762140,
			"version": 88,
			"versionNonce": 1717360292,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					202.109619140625,
					1.643157958984375
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": null
		},
		{
			"id": "p1r46MQHc6-49RJyvW9dW",
			"type": "line",
			"x": 579.5640716552734,
			"y": -170.2001495361328,
			"width": 192.79833984375,
			"height": 0,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1756961188,
			"version": 69,
			"versionNonce": 1534875036,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					192.79833984375,
					0
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": null
		},
		{
			"id": "VvxELWDk",
			"type": "text",
			"x": 587.2322235107422,
			"y": -161.4365692138672,
			"width": 186.673095703125,
			"height": 18,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 953518500,
			"version": 101,
			"versionNonce": 1767006756,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "-NLj8SGFJ0t8N3TAgCB-u",
					"type": "arrow"
				},
				{
					"id": "LnNTnhH3Ri_Y7h7iLr-2l",
					"type": "arrow"
				}
			],
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "sepc: app_base_address",
			"rawText": "sepc: app_base_address",
			"fontSize": 15.221656975387981,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "sepc: app_base_address"
		},
		{
			"id": "NCfjifN0",
			"type": "text",
			"x": 640.9090423583984,
			"y": -194.29994201660156,
			"width": 66.73458862304688,
			"height": 20.050474020106936,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1277631268,
			"version": 72,
			"versionNonce": 1427587612,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "sstatus",
			"rawText": "sstatus",
			"fontSize": 16.708728350089117,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "sstatus"
		},
		{
			"id": "WnQ8oXYm",
			"type": "text",
			"x": 579.5640716552734,
			"y": -266.5992889404297,
			"width": 212.4663543701172,
			"height": 54,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 49706276,
			"version": 206,
			"versionNonce": 478838180,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "        s: [0; 32]\n(32个User Mode下的寄存器)\n(sp = &UserStack[app_id]）",
			"rawText": "        s: [0; 32]\n(32个User Mode下的寄存器)\n(sp = &UserStack[app_id]）",
			"fontSize": 15.06927679753669,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "        s: [0; 32]\n(32个User Mode下的寄存器)\n(sp = &UserStack[app_id]）"
		},
		{
			"id": "KVVNMG8g",
			"type": "text",
			"x": 581.0164642333984,
			"y": -101.23701477050781,
			"width": 205.4125518798828,
			"height": 28.799999999999997,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 899929636,
			"version": 279,
			"versionNonce": 631283356,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "从User Mode回到Kernel Mode后，\n    内核sp用的都是这个栈",
			"rawText": "从User Mode回到Kernel Mode后，\n    内核sp用的都是这个栈",
			"fontSize": 12.867568584818963,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "从User Mode回到Kernel Mode后，\n    内核sp用的都是这个栈"
		},
		{
			"id": "LxP9apy3",
			"type": "text",
			"x": 202.30785137581603,
			"y": 2.6259920289675165,
			"width": 283.4999694824219,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1246416420,
			"version": 104,
			"versionNonce": 2033396004,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "初始时所有的TCB的内容都一样",
			"rawText": "初始时所有的TCB的内容都一样",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "初始时所有的TCB的内容都一样"
		},
		{
			"type": "text",
			"version": 205,
			"versionNonce": 1170893596,
			"isDeleted": false,
			"id": "VMVfCLli",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 534.3662213048643,
			"y": -1.039763653960108,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 373.919921875,
			"height": 24,
			"seed": 907309852,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "初始时所有的KernelStack的内容也都一样",
			"rawText": "初始时所有的KernelStack的内容也都一样",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "初始时所有的KernelStack的内容也都一样"
		},
		{
			"id": "DCGxExlD",
			"type": "text",
			"x": -477.5916433371708,
			"y": 99.45441755795002,
			"width": 851.0994873046875,
			"height": 48,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1827760932,
			"version": 204,
			"versionNonce": 582640804,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "CIBGEtZLvowk3X6fzYd8B",
					"type": "arrow"
				}
			],
			"updated": 1681055164169,
			"link": null,
			"locked": false,
			"text": "run_first_task(): \n用一个临时变量TaskContext作为current，tasks[0].TaskContext作为next调用__switch()",
			"rawText": "run_first_task(): \n用一个临时变量TaskContext作为current，tasks[0].TaskContext作为next调用__switch()",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "run_first_task(): \n用一个临时变量TaskContext作为current，tasks[0].TaskContext作为next调用__switch()"
		},
		{
			"id": "CIBGEtZLvowk3X6fzYd8B",
			"type": "arrow",
			"x": -396.1825234072925,
			"y": 148.5691067382416,
			"width": 1.3217832112396763,
			"height": 36.34859643817242,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 2055147556,
			"version": 135,
			"versionNonce": 1208395676,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					1.3217832112396763,
					36.34859643817242
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "DCGxExlD",
				"focus": 0.8091831720683831,
				"gap": 1.1146891802915775
			},
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "ydECjwzP",
			"type": "text",
			"x": -472.1841006665834,
			"y": 182.93502835955445,
			"width": 814.7796630859375,
			"height": 72,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1625243932,
			"version": 216,
			"versionNonce": 516829220,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "ozRY-dPlGtxkaXFXWvn08",
					"type": "arrow"
				}
			],
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"text": "__switch(current_task_cx, next_task_cx): \n保存当前内容到current，加载next的内容到寄存器中（sp=KernelStack; ra=__restore）\n之后ret返回到__restore()中",
			"rawText": "__switch(current_task_cx, next_task_cx): \n保存当前内容到current，加载next的内容到寄存器中（sp=KernelStack; ra=__restore）\n之后ret返回到__restore()中",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "__switch(current_task_cx, next_task_cx): \n保存当前内容到current，加载next的内容到寄存器中（sp=KernelStack; ra=__restore）\n之后ret返回到__restore()中"
		},
		{
			"id": "ozRY-dPlGtxkaXFXWvn08",
			"type": "arrow",
			"x": -393.0783065509877,
			"y": 257.322966665119,
			"width": 0.660891605619895,
			"height": 46.261823232163806,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 30093852,
			"version": 31,
			"versionNonce": 224168868,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-0.660891605619895,
					46.261823232163806
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "ydECjwzP",
				"focus": 0.8034624123580344,
				"gap": 2.3879383055645462
			},
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "CWmDXL0I",
			"type": "text",
			"x": -461.1492581879936,
			"y": 302.263006686043,
			"width": 1064.999267578125,
			"height": 144,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 176820508,
			"version": 493,
			"versionNonce": 1832808604,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "MY51Po8e0da2fcUatw8dh",
					"type": "arrow"
				}
			],
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"text": "__restore():\n(进入之前sp=KernelStack)\n将KernelStack中TrapContext的sstatus、sepc、sp(UserStack)的内容分别存到寄存器sstatus、sepc、sscratch中\n之后取出其他寄存器内容到对应的寄存器中\n然后交换sscratch和sp寄存器内容（交换后sscratch=KernelStack, sp=UserStack）\n最后iret返回用户空间（sepc=app_base_address）",
			"rawText": "__restore():\n(进入之前sp=KernelStack)\n将KernelStack中TrapContext的sstatus、sepc、sp(UserStack)的内容分别存到寄存器sstatus、sepc、sscratch中\n之后取出其他寄存器内容到对应的寄存器中\n然后交换sscratch和sp寄存器内容（交换后sscratch=KernelStack, sp=UserStack）\n最后iret返回用户空间（sepc=app_base_address）",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "__restore():\n(进入之前sp=KernelStack)\n将KernelStack中TrapContext的sstatus、sepc、sp(UserStack)的内容分别存到寄存器sstatus、sepc、sscratch中\n之后取出其他寄存器内容到对应的寄存器中\n然后交换sscratch和sp寄存器内容（交换后sscratch=KernelStack, sp=UserStack）\n最后iret返回用户空间（sepc=app_base_address）"
		},
		{
			"id": "-NLj8SGFJ0t8N3TAgCB-u",
			"type": "arrow",
			"x": -1.2834941163772555,
			"y": 433.8790966942465,
			"width": 945.5015463474047,
			"height": 576.8079146509618,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1510950308,
			"version": 818,
			"versionNonce": 1037958428,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					945.5015463474047,
					-61.118648394133174
				],
				[
					776.4426189286579,
					-576.8079146509618
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": {
				"elementId": "VvxELWDk",
				"focus": -0.950007709798527,
				"gap": 1.2538055984134644
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "BQI4pF6lTWmGK2HUkEiQt",
			"type": "arrow",
			"x": 239.20963126853223,
			"y": -156.18284096320946,
			"width": 200.1638076096633,
			"height": 362.12848125652766,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1081706020,
			"version": 77,
			"versionNonce": 1540880796,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-200.1638076096633,
					362.12848125652766
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "32gpbYNv",
				"focus": 0.8646558863769245,
				"gap": 2.8442006627670935
			},
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "XwaWxwxwNo2Wcn8n1j0NN",
			"type": "arrow",
			"x": 589.8783340258584,
			"y": -215.77360828162642,
			"width": 81.74630928659167,
			"height": 567.6401812424447,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 2068187940,
			"version": 159,
			"versionNonce": 1760755236,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-81.74630928659167,
					261.2825624214679
				],
				[
					-49.658912462000444,
					567.6401812424447
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "HUvpxVuhrFyDIHHoUnX2Y",
			"type": "arrow",
			"x": 29.11399008598653,
			"y": 231.15709339766522,
			"width": 267.3944059773469,
			"height": 97.78992256475021,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1202070308,
			"version": 61,
			"versionNonce": 308176412,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-267.3944059773469,
					97.78992256475021
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "8piDMa2L8sieRnoyM-poL",
			"type": "rectangle",
			"x": -502.7041742754964,
			"y": 77.88383297538508,
			"width": 1143.6575936639663,
			"height": 393.4901581616424,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dashed",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 122342300,
			"version": 113,
			"versionNonce": 364353956,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false
		},
		{
			"id": "5FZI9ARd",
			"type": "text",
			"x": -463.7320760811647,
			"y": 616.7188467039872,
			"width": 1043.7994384765625,
			"height": 72,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dashed",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1247071524,
			"version": 373,
			"versionNonce": 1856158756,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "v7O0A5o_r0fzm5nAHXSWp",
					"type": "arrow"
				},
				{
					"id": "xFSdTnmHFTRGwBu-Gw_Xd",
					"type": "arrow"
				}
			],
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"text": "用户下：sys_yield() -> syscall() -> 内核下：syscall() -> sys_yield() -> suspend_current_and_run_next()\n(sys_exit() 和 sys_yield()类似)\n之后会调用mark_current_suspend()（标记当前task的status为‘Ready'）和run_next_task()（调用下一个app）",
			"rawText": "用户下：sys_yield() -> syscall() -> 内核下：syscall() -> sys_yield() -> suspend_current_and_run_next()\n(sys_exit() 和 sys_yield()类似)\n之后会调用mark_current_suspend()（标记当前task的status为‘Ready'）和run_next_task()（调用下一个app）",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "用户下：sys_yield() -> syscall() -> 内核下：syscall() -> sys_yield() -> suspend_current_and_run_next()\n(sys_exit() 和 sys_yield()类似)\n之后会调用mark_current_suspend()（标记当前task的status为‘Ready'）和run_next_task()（调用下一个app）"
		},
		{
			"id": "v7O0A5o_r0fzm5nAHXSWp",
			"type": "arrow",
			"x": -391.9497514122588,
			"y": 696.7019384603385,
			"width": 1.235208655894894,
			"height": 58.45760177123873,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1883096356,
			"version": 606,
			"versionNonce": 196623140,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055468924,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-1.235208655894894,
					58.45760177123873
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "5FZI9ARd",
				"focus": 0.8594261839943903,
				"gap": 7.983091756351314
			},
			"endBinding": {
				"elementId": "vY17chNV",
				"focus": -0.818690833173524,
				"gap": 6.844261187596999
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "vY17chNV",
			"type": "text",
			"x": -460.77487378400156,
			"y": 762.0038014191742,
			"width": 742.459716796875,
			"height": 72,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 932977060,
			"version": 359,
			"versionNonce": 1437926180,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "bzvZJzkfFjQ7HTNroLGuh",
					"type": "arrow"
				},
				{
					"id": "v7O0A5o_r0fzm5nAHXSWp",
					"type": "arrow"
				}
			],
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"text": "run_next_task():\n标记下一个tasks[next].task_status = 'Running'\n对当前task和找到的下一个task（若无则下一个就是当前的task）调用__switch()",
			"rawText": "run_next_task():\n标记下一个tasks[next].task_status = 'Running'\n对当前task和找到的下一个task（若无则下一个就是当前的task）调用__switch()",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "run_next_task():\n标记下一个tasks[next].task_status = 'Running'\n对当前task和找到的下一个task（若无则下一个就是当前的task）调用__switch()"
		},
		{
			"id": "bzvZJzkfFjQ7HTNroLGuh",
			"type": "arrow",
			"x": -393.25986462876574,
			"y": 840.7966265614532,
			"width": 9.395291627121765,
			"height": 56.80411432066319,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 887850660,
			"version": 1747,
			"versionNonce": 114112164,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055468924,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					9.395291627121765,
					56.80411432066319
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "vY17chNV",
				"focus": 0.8239812516962066,
				"gap": 6.792825142278957
			},
			"endBinding": {
				"elementId": "jYnTPPES",
				"focus": -0.8560578488237435,
				"gap": 2.7485186618999933
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "jYnTPPES",
			"type": "text",
			"x": -448.8642859300618,
			"y": 900.3492595440164,
			"width": 1165.3795166015625,
			"height": 120,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 571507108,
			"version": 728,
			"versionNonce": 1411484196,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "bzvZJzkfFjQ7HTNroLGuh",
					"type": "arrow"
				},
				{
					"id": "MY51Po8e0da2fcUatw8dh",
					"type": "arrow"
				},
				{
					"id": "ArwD39uGY0TpzReSChVaO",
					"type": "arrow"
				}
			],
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"text": "__switch(current_task_cx, next_task_cx):\n保存当前内容到current，加载next的内容到寄存器\n将当前ra(ra=调用__switch函数的位置) 和sp(sp=当前栈顶的位置) 保存到current_task_cx中\n加载next_task_cx内容到当前寄存器中\n(若next为第一次调用：ra=__restore, sp=KernelStack；否则: ra=next上次调用__switch的位置, sp=KernelStack用到的位置)",
			"rawText": "__switch(current_task_cx, next_task_cx):\n保存当前内容到current，加载next的内容到寄存器\n将当前ra(ra=调用__switch函数的位置) 和sp(sp=当前栈顶的位置) 保存到current_task_cx中\n加载next_task_cx内容到当前寄存器中\n(若next为第一次调用：ra=__restore, sp=KernelStack；否则: ra=next上次调用__switch的位置, sp=KernelStack用到的位置)",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "__switch(current_task_cx, next_task_cx):\n保存当前内容到current，加载next的内容到寄存器\n将当前ra(ra=调用__switch函数的位置) 和sp(sp=当前栈顶的位置) 保存到current_task_cx中\n加载next_task_cx内容到当前寄存器中\n(若next为第一次调用：ra=__restore, sp=KernelStack；否则: ra=next上次调用__switch的位置, sp=KernelStack用到的位置)"
		},
		{
			"id": "HrHC9K3F",
			"type": "text",
			"x": 487.62506950926627,
			"y": -176.56345245439337,
			"width": 40,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1866708644,
			"version": 22,
			"versionNonce": 1846481700,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"text": "栈顶",
			"rawText": "栈顶",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "栈顶"
		},
		{
			"type": "rectangle",
			"version": 519,
			"versionNonce": 140005668,
			"isDeleted": false,
			"id": "o7cKruMI-yDgrIn5wmAfP",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 638.5182485393191,
			"y": 564.7589291338812,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 213.0640869140625,
			"height": 318.226806640625,
			"seed": 722830884,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false
		},
		{
			"type": "text",
			"version": 466,
			"versionNonce": 82559772,
			"isDeleted": false,
			"id": "BWWFf4W2",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 684.5269155315066,
			"y": 535.1819027666937,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 113.91990661621094,
			"height": 24,
			"seed": 1602772508,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "KernelStack",
			"rawText": "KernelStack",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "KernelStack"
		},
		{
			"type": "text",
			"version": 369,
			"versionNonce": 1660587172,
			"isDeleted": false,
			"id": "PVHiugOh",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 858.8480825236941,
			"y": 859.3588436846625,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 38.759979248046875,
			"height": 24,
			"seed": 38347172,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "0x0",
			"rawText": "0x0",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "0x0"
		},
		{
			"type": "text",
			"version": 387,
			"versionNonce": 1228734364,
			"isDeleted": false,
			"id": "VApfGglK",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 854.4663686565066,
			"y": 549.3478268389593,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 72.13995361328125,
			"height": 24,
			"seed": 2072918684,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "0x8192",
			"rawText": "0x8192",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "0x8192"
		},
		{
			"type": "rectangle",
			"version": 646,
			"versionNonce": 885610532,
			"isDeleted": false,
			"id": "Ud9sKpuzoKnE6xQR5l02v",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 641.5550527385378,
			"y": 568.0864590411078,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 207.58685302734375,
			"height": 198.27558898925778,
			"seed": 2004700452,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"boundElements": [
				{
					"id": "xFSdTnmHFTRGwBu-Gw_Xd",
					"type": "arrow"
				},
				{
					"id": "GNFig8VBbPysDXaI5nnDa",
					"type": "arrow"
				}
			],
			"updated": 1681055468888,
			"link": null,
			"locked": false
		},
		{
			"type": "rectangle",
			"version": 404,
			"versionNonce": 650037404,
			"isDeleted": false,
			"id": "wwj5bjgDMZclc56rMKy3O",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 676.1570424846316,
			"y": 579.0409115557562,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 139.12152099609375,
			"height": 32.31561279296875,
			"seed": 1134855964,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false
		},
		{
			"type": "text",
			"version": 366,
			"versionNonce": 1071947556,
			"isDeleted": false,
			"id": "SFcSFS8m",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 684.6592397502566,
			"y": 582.2317990069281,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 125.95988464355469,
			"height": 24,
			"seed": 471861412,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "TrapContext",
			"rawText": "TrapContext",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "TrapContext"
		},
		{
			"type": "line",
			"version": 433,
			"versionNonce": 361977116,
			"isDeleted": false,
			"id": "sjIW3L3I1Fa5G4-Fe-R5_",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 641.6928090861941,
			"y": 697.3489865069281,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 202.109619140625,
			"height": 1.643157958984375,
			"seed": 1010647964,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"startBinding": null,
			"endBinding": null,
			"lastCommittedPoint": null,
			"startArrowhead": null,
			"endArrowhead": null,
			"points": [
				[
					0,
					0
				],
				[
					202.109619140625,
					1.643157958984375
				]
			]
		},
		{
			"type": "line",
			"version": 477,
			"versionNonce": 1070406308,
			"isDeleted": false,
			"id": "jpTkdA-N1CGHH-i3v6l3x",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 647.3705278053642,
			"y": 734.9950428417526,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 192.79833984375,
			"height": 0,
			"seed": 601838628,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"startBinding": null,
			"endBinding": null,
			"lastCommittedPoint": null,
			"startArrowhead": null,
			"endArrowhead": null,
			"points": [
				[
					0,
					0
				],
				[
					192.79833984375,
					0
				]
			]
		},
		{
			"type": "text",
			"version": 506,
			"versionNonce": 1126322588,
			"isDeleted": false,
			"id": "uOFymknO",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 664.3828251477668,
			"y": 736.7850216631781,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 153.12823486328125,
			"height": 18,
			"seed": 193622044,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 15.221656975387981,
			"fontFamily": 1,
			"text": "sepc: User的返回地址",
			"rawText": "sepc: User的返回地址",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "sepc: User的返回地址"
		},
		{
			"type": "text",
			"version": 417,
			"versionNonce": 874128932,
			"isDeleted": false,
			"id": "pvza9kpE",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 705.2286977580691,
			"y": 703.9216488604437,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 66.73458862304688,
			"height": 20.050474020106936,
			"seed": 480849828,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 16.708728350089117,
			"fontFamily": 1,
			"text": "sstatus",
			"rawText": "sstatus",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "sstatus"
		},
		{
			"type": "text",
			"version": 602,
			"versionNonce": 1318960668,
			"isDeleted": false,
			"id": "X86Jv3AU",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 643.8837270549441,
			"y": 631.6223019366156,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 200.5388641357422,
			"height": 54,
			"seed": 1098779804,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 15.06927679753669,
			"fontFamily": 1,
			"text": "        s: [xxx; 32]\n(32个User Mode下的寄存器)\n(sp = User的sp栈顶）",
			"rawText": "        s: [xxx; 32]\n(32个User Mode下的寄存器)\n(sp = User的sp栈顶）",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "        s: [xxx; 32]\n(32个User Mode下的寄存器)\n(sp = User的sp栈顶）"
		},
		{
			"type": "text",
			"version": 624,
			"versionNonce": 1102692772,
			"isDeleted": false,
			"id": "EbtYCaJd",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 645.3361196330691,
			"y": 796.9845761065375,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"width": 205.4125518798828,
			"height": 28.799999999999997,
			"seed": 648780580,
			"groupIds": [],
			"roundness": null,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"fontSize": 12.867568584818963,
			"fontFamily": 1,
			"text": "从User Mode回到Kernel Mode后，\n    内核sp用的都是这个栈",
			"rawText": "从User Mode回到Kernel Mode后，\n    内核sp用的都是这个栈",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "从User Mode回到Kernel Mode后，\n    内核sp用的都是这个栈"
		},
		{
			"id": "RYsJFhiP",
			"type": "text",
			"x": 633.072620887662,
			"y": 902.8528785881813,
			"width": 233.91990661621094,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 976808476,
			"version": 255,
			"versionNonce": 553097884,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"text": "系统调用后的KernelStack",
			"rawText": "系统调用后的KernelStack",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "系统调用后的KernelStack"
		},
		{
			"id": "xFSdTnmHFTRGwBu-Gw_Xd",
			"type": "arrow",
			"x": -130.21056142433173,
			"y": 615.3783951568352,
			"width": 767.9580545246163,
			"height": 54.91643186577119,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 2138747812,
			"version": 901,
			"versionNonce": 1555481124,
			"isDeleted": false,
			"boundElements": [],
			"updated": 1681055468924,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					272.8386618174541,
					-54.91643186577119
				],
				[
					767.9580545246163,
					-38.66160546816502
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "5FZI9ARd",
				"focus": -0.5335588307180594,
				"gap": 1.3404515471520426
			},
			"endBinding": {
				"elementId": "Ud9sKpuzoKnE6xQR5l02v",
				"focus": 0.8481605039951883,
				"gap": 3.807559638253224
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "aEgC2YFd",
			"type": "text",
			"x": 63.30435468298708,
			"y": 570.0505196504309,
			"width": 436.27978515625,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1531146396,
			"version": 178,
			"versionNonce": 887219996,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"text": "ecall进入Trap.S中的__alltarps()中保存上下文",
			"rawText": "ecall进入Trap.S中的__alltarps()中保存上下文",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "ecall进入Trap.S中的__alltarps()中保存上下文"
		},
		{
			"id": "MY51Po8e0da2fcUatw8dh",
			"type": "arrow",
			"x": -447.2831889820208,
			"y": 1023.0318726947985,
			"width": 93.56059208343203,
			"height": 689.0988426236564,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1503001636,
			"version": 756,
			"versionNonce": 1351499684,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055477742,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-93.56059208343203,
					-95.3041244884007
				],
				[
					-20.317307880423357,
					-689.0988426236564
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "jYnTPPES",
				"focus": -1.00164035591614,
				"gap": 2.6826131507821174
			},
			"endBinding": {
				"elementId": "CWmDXL0I",
				"focus": 1.0047005931852309,
				"gap": 6.451238674450565
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "ArwD39uGY0TpzReSChVaO",
			"type": "arrow",
			"x": 138.25963394469719,
			"y": 1024.8719917168737,
			"width": 3.5780989326063377,
			"height": 70.60684097027752,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1713387044,
			"version": 1461,
			"versionNonce": 1684200868,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055468924,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-3.5780989326063377,
					70.60684097027752
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "jYnTPPES",
				"focus": -0.013152707608372817,
				"gap": 4.5227321728573315
			},
			"endBinding": {
				"elementId": "GTPcTtXY",
				"focus": -0.13216369241689874,
				"gap": 11.332005302672997
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "GTPcTtXY",
			"type": "text",
			"x": -524.1170532201268,
			"y": 1106.8108379898242,
			"width": 1514.49951171875,
			"height": 48,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 2026221860,
			"version": 643,
			"versionNonce": 1590600604,
			"isDeleted": false,
			"boundElements": [
				{
					"id": "ArwD39uGY0TpzReSChVaO",
					"type": "arrow"
				},
				{
					"id": "GNFig8VBbPysDXaI5nnDa",
					"type": "arrow"
				}
			],
			"updated": 1681055468888,
			"link": null,
			"locked": false,
			"text": "回到了next上次调用__switch的位置，之后不断返回，最后返回到最开始调用__alltraps()的call trap_handler位置（这时sp也回到KernelStack的TraoContext位置）\n__alltraps()结束后面紧跟着的就是__restore()：从TraoContext恢复上下文，iret从Kernel返回到User",
			"rawText": "回到了next上次调用__switch的位置，之后不断返回，最后返回到最开始调用__alltraps()的call trap_handler位置（这时sp也回到KernelStack的TraoContext位置）\n__alltraps()结束后面紧跟着的就是__restore()：从TraoContext恢复上下文，iret从Kernel返回到User",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "回到了next上次调用__switch的位置，之后不断返回，最后返回到最开始调用__alltraps()的call trap_handler位置（这时sp也回到KernelStack的TraoContext位置）\n__alltraps()结束后面紧跟着的就是__restore()：从TraoContext恢复上下文，iret从Kernel返回到User"
		},
		{
			"id": "GNFig8VBbPysDXaI5nnDa",
			"type": "arrow",
			"x": 834.0243796928236,
			"y": 1102.3331509441336,
			"width": 212.6921259622451,
			"height": 339.08700184970644,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 1629809956,
			"version": 644,
			"versionNonce": 1728022820,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055468924,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					212.6921259622451,
					-172.59445158147093
				],
				[
					19.177209854926218,
					-339.08700184970644
				]
			],
			"lastCommittedPoint": null,
			"startBinding": {
				"elementId": "GTPcTtXY",
				"focus": 0.7190895046783755,
				"gap": 4.477687045690573
			},
			"endBinding": {
				"elementId": "Ud9sKpuzoKnE6xQR5l02v",
				"focus": 0.017137571596650927,
				"gap": 4.059683781868216
			},
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "EOqdEr1iNvri2lQByQ_fK",
			"type": "rectangle",
			"x": -563.7191565827447,
			"y": 509.1480856153181,
			"width": 1651.930874119425,
			"height": 704.4008929776925,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dashed",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 997108516,
			"version": 79,
			"versionNonce": 1755888924,
			"isDeleted": false,
			"boundElements": null,
			"updated": 1681055496401,
			"link": null,
			"locked": false
		},
		{
			"id": "S2AE0NmQ77QgHPuOeLGwR",
			"type": "rectangle",
			"x": -482.3969895893096,
			"y": 95.0375863119894,
			"width": 189.67353416799386,
			"height": 27.757116032844237,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 609362076,
			"version": 69,
			"versionNonce": 545739804,
			"isDeleted": true,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false
		},
		{
			"id": "ujK2h0AM",
			"type": "text",
			"x": -204.26369580580922,
			"y": 336.9034774388191,
			"width": 10,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1299682460,
			"version": 6,
			"versionNonce": 1620277028,
			"isDeleted": true,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"text": "",
			"rawText": "",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": ""
		},
		{
			"id": "25G-ZqOePgu0wdXBkaZeu",
			"type": "arrow",
			"x": -225.00374720438685,
			"y": 325.3934319440573,
			"width": 215.4435122752651,
			"height": 301.00979029532584,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 959402788,
			"version": 422,
			"versionNonce": 350286500,
			"isDeleted": true,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					215.4435122752651,
					-301.00979029532584
				]
			],
			"lastCommittedPoint": null,
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "vCN-JhoFgdIsAMo8uhsuI",
			"type": "rectangle",
			"x": -497.63127266100827,
			"y": 550.8083098979033,
			"width": 1141.5793747849198,
			"height": 464.5110885808374,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dashed",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 3
			},
			"seed": 429442212,
			"version": 113,
			"versionNonce": 1986216604,
			"isDeleted": true,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false
		},
		{
			"id": "XJznoQQvEOwIKMd305Vpw",
			"type": "arrow",
			"x": -89.00814252948612,
			"y": 819.2535680661755,
			"width": 197.8981421552612,
			"height": 76.04425543252285,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": {
				"type": 2
			},
			"seed": 937175460,
			"version": 60,
			"versionNonce": 273711268,
			"isDeleted": true,
			"boundElements": [],
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"points": [
				[
					0,
					0
				],
				[
					-104.44626154499849,
					-46.7259403051313
				],
				[
					-56.80411432066319,
					-21.98865977375965
				],
				[
					93.45188061026272,
					-76.04425543252285
				]
			],
			"lastCommittedPoint": [
				93.45188061026272,
				-76.04425543252285
			],
			"startBinding": null,
			"endBinding": null,
			"startArrowhead": null,
			"endArrowhead": "arrow"
		},
		{
			"id": "ggkh8s09",
			"type": "text",
			"x": -180.37542355475898,
			"y": 779.6175163392281,
			"width": 10,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 896479268,
			"version": 6,
			"versionNonce": 997215132,
			"isDeleted": true,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"text": "",
			"rawText": "",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "center",
			"verticalAlign": "middle",
			"containerId": "XJznoQQvEOwIKMd305Vpw",
			"originalText": ""
		},
		{
			"id": "bTOhoaKh",
			"type": "text",
			"x": -447.24055572691697,
			"y": 672.6622987163536,
			"width": 10,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 775900060,
			"version": 5,
			"versionNonce": 725666852,
			"isDeleted": true,
			"boundElements": null,
			"updated": 1681055164170,
			"link": null,
			"locked": false,
			"text": "",
			"rawText": "",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": ""
		},
		{
			"id": "pCS85DxI",
			"type": "text",
			"x": 97.53037744425228,
			"y": 502.30716784331696,
			"width": 10,
			"height": 24,
			"angle": 0,
			"strokeColor": "#000000",
			"backgroundColor": "transparent",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "dotted",
			"roughness": 1,
			"opacity": 100,
			"groupIds": [],
			"roundness": null,
			"seed": 1169124124,
			"version": 5,
			"versionNonce": 1362013988,
			"isDeleted": true,
			"boundElements": null,
			"updated": 1681055164171,
			"link": null,
			"locked": false,
			"text": "",
			"rawText": "",
			"fontSize": 20,
			"fontFamily": 1,
			"textAlign": "center",
			"verticalAlign": "middle",
			"containerId": "xFSdTnmHFTRGwBu-Gw_Xd",
			"originalText": ""
		}
	],
	"appState": {
		"theme": "light",
		"viewBackgroundColor": "#ffffff",
		"currentItemStrokeColor": "#000000",
		"currentItemBackgroundColor": "transparent",
		"currentItemFillStyle": "hachure",
		"currentItemStrokeWidth": 1,
		"currentItemStrokeStyle": "dashed",
		"currentItemRoughness": 1,
		"currentItemOpacity": 100,
		"currentItemFontFamily": 1,
		"currentItemFontSize": 20,
		"currentItemTextAlign": "left",
		"currentItemStartArrowhead": null,
		"currentItemEndArrowhead": "arrow",
		"scrollX": 1024.3552399539399,
		"scrollY": -104.9675510599427,
		"zoom": {
			"value": 0.547178842304038
		},
		"currentItemRoundness": "round",
		"gridSize": null,
		"colorPalette": {},
		"currentStrokeOptions": null,
		"previousGridSize": null
	},
	"files": {}
}
```
%%